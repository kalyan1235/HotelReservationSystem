<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hotel Reservation System</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- ✅ Top Navbar -->
  <header class="navbar">
    <h1>Hotel Reservation System</h1>
    <nav>
      <button onclick="loadRooms()">Available Rooms</button>
      <button onclick="loadReservations()">All Reservations</button>
    </nav>
  </header>

  <!-- ✅ Main Content -->
  <main class="content">
    <!-- Booking Form -->
    <section class="card">
      <h2>Book a Room</h2>
      <form id="bookForm">
        <input type="text" name="customerName" placeholder="Customer Name" required />
        <input type="number" name="roomId" placeholder="Room ID (from Available Rooms)" required />
        <label>Check-in <input type="date" name="checkIn" required /></label>
        <label>Check-out <input type="date" name="checkOut" required /></label>
        <button type="submit">Book</button>
      </form>
    </section>

    <!-- Cancel Booking -->
    <section class="card">
      <h2>Cancel Booking</h2>
      <form id="cancelForm">
        <input type="number" name="bookingId" placeholder="Booking ID (from Reservations)" required />
        <button type="submit">Cancel Booking</button>
      </form>
    </section>

    <!-- Search Reservations -->
    <section class="card">
      <h2>🔎 Search Reservations</h2>
      <form id="searchForm">
        <input type="text" name="customerName" placeholder="Enter Customer Name" />
        <button type="submit">Search</button>
      </form>
    </section>

    <!-- Output Section -->
    <section class="card">
      <h2>Output</h2>
      <pre id="output">(results will appear here)</pre>
    </section>
  </main>

  <!-- ✅ Footer -->
  <footer class="footer">
    <p>&copy; 2025 Hotel Reservation System | Contact: adhivirat@hotel.com | +1 xxxxx-4567</p>
  </footer>

  <!-- ✅ Script (All inside HTML) -->
  <script>
    // 🌀 Loading Spinner
    function showSpinner() {
      document.getElementById("output").innerHTML = "<div class='spinner'></div>";
    }

    // 🍞 Toast Notification
    function showToast(msg) {
      let toast = document.createElement("div");
      toast.className = "toast";
      toast.innerText = msg;
      document.body.appendChild(toast);
      setTimeout(() => toast.classList.add("show"), 100);
      setTimeout(() => { toast.remove(); }, 3000);
    }

    // 📌 Load Rooms
    async function loadRooms() {
      showSpinner();
      const res = await fetch("RoomServlet");
      const data = await res.json();
      document.getElementById("output").textContent = JSON.stringify(data, null, 2);
    }

    // 📌 Load Reservations
    async function loadReservations() {
      showSpinner();
      const res = await fetch("ReservationsServlet");
      const data = await res.json();
      document.getElementById("output").textContent = JSON.stringify(data, null, 2);
    }

    // 📌 Book Room with validation
    document.getElementById("bookForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const checkIn = new Date(formData.get("checkIn"));
      const checkOut = new Date(formData.get("checkOut"));

      if (checkOut <= checkIn) {
        showToast("❌ Check-out must be after Check-in!");
        return;
      }

      const params = new URLSearchParams(formData);
      const res = await fetch("BookingServlet", { method: "POST", body: params });
      const data = await res.json();
      showToast(data.msg);
      document.getElementById("output").textContent = JSON.stringify(data, null, 2);
    });

    // 📌 Cancel Booking
    document.getElementById("cancelForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const params = new URLSearchParams(new FormData(e.target));
      const res = await fetch("CancelServlet", { method: "POST", body: params });
      const data = await res.json();
      showToast(data.msg);
      document.getElementById("output").textContent = JSON.stringify(data, null, 2);
    });

    // 📌 Search Reservations
    document.getElementById("searchForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      showSpinner();
      const params = new URLSearchParams(new FormData(e.target));
      const res = await fetch("SearchServlet?" + params);
      const data = await res.json();
      document.getElementById("output").textContent = JSON.stringify(data, null, 2);
    });
  </script>
</body>
</html>
